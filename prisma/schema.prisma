generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  user_id     String    @id @default(uuid())
  user_name   String    @unique @db.VarChar(20)
  public_name String    @db.VarChar()
  birth_date  DateTime? @db.Date
  password    String    @db.VarChar()

  phone_number String @db.VarChar()
  email        String @unique @db.VarChar()
  user_bio     String @db.Text

  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  ChatParticipant ChatParticipant[]

  @@map("user")
}

enum ChatType {
  PRIVATE
  GROUP
}

model Chat {
  chat_id   String   @id @default(uuid())
  chat_type ChatType @default(PRIVATE)

  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  ChatParticipant ChatParticipant[]

  @@map("chat")
}

model ChatParticipant {
  chatParticipantId String    @id @default(uuid())
  chatId            String
  userId            String
  role              ChatRoles
  lastSeenAt        DateTime?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @default(now())
  deletedAt DateTime?

  chat Chat @relation(fields: [chatId], references: [chat_id])
  user User @relation(fields: [userId], references: [user_id])

  @@map("chat_participant")
}

enum ChatRoles {
  ADMIN
  MEMBER
  COMMON
}
